# Phase 1.1: Project Setup Implementation

## Overview
This document provides detailed implementation instructions for setting up the ScratchRobin development environment, build system, and project structure.

## Prerequisites

### System Requirements
- **Operating System**: Linux (Ubuntu 20.04+), macOS (12+), Windows (10+)
- **Memory**: 8GB RAM minimum, 16GB recommended
- **Storage**: 10GB free space
- **Network**: Internet connection for dependency downloads

### Required Software
- **Git**: Version control system
- **Node.js**: v18.0.0+ (for web interface)
- **npm**: v8.0.0+ (comes with Node.js)
- **Python**: v3.8+ (for build scripts and client library)
- **Go**: v1.19+ (for CLI tools and Go client)
- **Java**: JDK 11+ (for Java client and testing)
- **CMake**: v3.20+ (for C++ components)
- **Visual Studio Code** or preferred IDE

## Step-by-Step Implementation

### Step 1: Repository Setup

#### 1.1 Initialize Git Repository
```bash
# Create project directory
mkdir -p /home/dcalford/CliWork/ScratchRobin
cd /home/dcalford/CliWork/ScratchRobin

# Initialize git repository
git init
git config user.name "ScratchRobin Team"
git config user.email "team@scratchrobin.org"

# Create initial .gitignore
cat > .gitignore << 'EOF'
# Build artifacts
build/
dist/
out/
bin/
obj/

# Dependencies
node_modules/
__pycache__/
*.pyc
*.pyo
*.pyd
vendor/
target/

# IDE files
.vscode/
.idea/
*.swp
*.swo
*~

# OS files
.DS_Store
Thumbs.db

# Logs
*.log
logs/

# Environment files
.env
.env.local
.env.*.local

# Temporary files
tmp/
temp/
cache/
EOF
```

#### 1.2 Create Directory Structure
```bash
# Create complete directory structure
mkdir -p src/ web/ desktop/ cli/ client-libraries/
mkdir -p client-libraries/python client-libraries/java client-libraries/nodejs client-libraries/go client-libraries/cpp
mkdir -p tests/ docs/ scripts/
mkdir -p ProjectPlan/Phase1-10 ProjectPlan/Phase11-16 ProjectPlan/Phase17-22
mkdir -p ProjectPlan/Architecture ProjectPlan/Features ProjectPlan/Implementation
mkdir -p ProjectPlan/Testing ProjectPlan/Documentation ProjectPlan/Integration

# Create additional subdirectories
mkdir -p src/{core,components,utils,types}
mkdir -p web/{src,public,config}
mkdir -p desktop/{src,build,dist}
mkdir -p cli/{src,build,dist}
mkdir -p tests/{unit,integration,e2e,performance}
mkdir -p docs/{api,user,admin,developer}
```

### Step 2: Build System Configuration

#### 2.1 Root CMakeLists.txt
```cmake
cmake_minimum_required(VERSION 3.20)
project(ScratchRobin VERSION 0.1.0 LANGUAGES CXX)

# Set C++ standard
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_EXTENSIONS OFF)

# Build type configuration
if(NOT CMAKE_BUILD_TYPE)
    set(CMAKE_BUILD_TYPE "Release")
endif()

# Compiler flags
if(MSVC)
    add_compile_options(/W4 /permissive-)
else()
    add_compile_options(-Wall -Wextra -Wpedantic -Werror)
endif()

# Output directories
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/bin)
set(CMAKE_LIBRARY_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/lib)
set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/lib)

# Dependencies
find_package(Threads REQUIRED)

# Subdirectories
add_subdirectory(src)
add_subdirectory(tests)

# Installation
install(TARGETS scratchrobin
    RUNTIME DESTINATION bin
    LIBRARY DESTINATION lib
    ARCHIVE DESTINATION lib
)
```

#### 2.2 Package.json for Web Interface
```json
{
  "name": "scratchrobin-web",
  "version": "0.1.0",
  "description": "ScratchRobin Web Interface",
  "private": true,
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test",
    "eject": "react-scripts eject",
    "lint": "eslint src --ext .js,.jsx,.ts,.tsx",
    "format": "prettier --write src/**/*.{js,jsx,ts,tsx,css,md}"
  },
  "dependencies": {
    "@material-ui/core": "^4.12.4",
    "@material-ui/icons": "^4.11.3",
    "@material-ui/lab": "^4.0.0-alpha.61",
    "axios": "^1.4.0",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-router-dom": "^6.14.0",
    "react-scripts": "5.0.1",
    "socket.io-client": "^4.7.2",
    "typescript": "^4.9.5",
    "web-vitals": "^2.1.4"
  },
  "devDependencies": {
    "@testing-library/jest-dom": "^5.16.5",
    "@testing-library/react": "^13.4.0",
    "@testing-library/user-event": "^13.5.0",
    "@types/jest": "^27.5.2",
    "@types/node": "^16.18.38",
    "@types/react": "^18.2.15",
    "@types/react-dom": "^18.2.7",
    "eslint": "^8.45.0",
    "prettier": "^2.8.8"
  },
  "browserslist": {
    "production": [
      ">0.2%",
      "not dead",
      "not op_mini all"
    ],
    "development": [
      "last 1 chrome version",
      "last 1 firefox version",
      "last 1 safari version"
    ]
  }
}
```

#### 2.3 Go Module for CLI
```go
// cli/go.mod
module github.com/scratchbird/scratchrobin-cli

go 1.19

require (
    github.com/spf13/cobra v1.7.0
    github.com/spf13/viper v1.15.0
    github.com/stretchr/testify v1.8.4
    gopkg.in/yaml.v3 v3.0.1
)

// CLI main.go
package main

import (
    "os"

    "github.com/spf13/cobra"
)

var rootCmd = &cobra.Command{
    Use:   "scratchrobin-cli",
    Short: "ScratchRobin Command Line Interface",
    Long:  `A command line interface for managing ScratchBird databases`,
}

func main() {
    if err := rootCmd.Execute(); err != nil {
        os.Exit(1)
    }
}
```

### Step 3: Core Source Structure

#### 3.1 Main Application Structure
```cpp
// src/main.cpp
#include "scratchbird/engine.h"
#include "core/connection_manager.h"
#include "core/metadata_manager.h"
#include "ui/main_window.h"

int main(int argc, char* argv[]) {
    try {
        // Initialize ScratchBird engine
        auto engine = scratchbird::create_database("scratchbird.db");

        // Initialize core components
        auto connectionManager = std::make_unique<ConnectionManager>(engine);
        auto metadataManager = std::make_unique<MetadataManager>(connectionManager.get());

        // Create main UI
        MainWindow mainWindow(connectionManager.get(), metadataManager.get());
        mainWindow.show();

        return 0;
    } catch (const std::exception& e) {
        std::cerr << "Error: " << e.what() << std::endl;
        return 1;
    }
}
```

#### 3.2 Core Component Headers

```cpp
// src/core/connection_manager.h
#ifndef SCRATCHROBIN_CONNECTION_MANAGER_H
#define SCRATCHROBIN_CONNECTION_MANAGER_H

#include <memory>
#include <string>
#include <vector>
#include <unordered_map>

namespace scratchrobin {

class ConnectionManager {
public:
    ConnectionManager(scratchbird::Database* db);
    ~ConnectionManager();

    // Connection management
    bool connect(const std::string& connection_string);
    void disconnect(const std::string& connection_id);
    bool isConnected(const std::string& connection_id) const;

    // Connection pool management
    size_t getPoolSize() const;
    size_t getActiveConnections() const;
    void setMaxPoolSize(size_t size);

    // Event callbacks
    using ConnectionCallback = std::function<void(const std::string&)>;
    void setConnectionCallback(ConnectionCallback callback);
    void setDisconnectionCallback(ConnectionCallback callback);

private:
    class Impl;
    std::unique_ptr<Impl> impl_;
};

} // namespace scratchrobin

#endif // SCRATCHROBIN_CONNECTION_MANAGER_H
```

#### 3.3 Utility Functions

```cpp
// src/utils/string_utils.h
#ifndef SCRATCHROBIN_STRING_UTILS_H
#define SCRATCHROBIN_STRING_UTILS_H

#include <string>
#include <vector>

namespace scratchrobin::utils {

std::string trim(const std::string& str);
std::string toLower(const std::string& str);
std::string toUpper(const std::string& str);
std::vector<std::string> split(const std::string& str, char delimiter);
std::string join(const std::vector<std::string>& parts, const std::string& separator);
bool startsWith(const std::string& str, const std::string& prefix);
bool endsWith(const std::string& str, const std::string& suffix);

} // namespace scratchrobin::utils

#endif // SCRATCHROBIN_STRING_UTILS_H
```

### Step 4: Testing Framework Setup

#### 4.1 Unit Testing Structure

```cpp
// tests/unit/test_string_utils.cpp
#include "utils/string_utils.h"
#include <gtest/gtest.h>

TEST(StringUtilsTest, Trim) {
    EXPECT_EQ(scratchrobin::utils::trim("  hello  "), "hello");
    EXPECT_EQ(scratchrobin::utils::trim("hello"), "hello");
    EXPECT_EQ(scratchrobin::utils::trim(""), "");
}

TEST(StringUtilsTest, ToLower) {
    EXPECT_EQ(scratchrobin::utils::toLower("HELLO"), "hello");
    EXPECT_EQ(scratchrobin::utils::toLower("Hello World"), "hello world");
    EXPECT_EQ(scratchrobin::utils::toLower("123"), "123");
}

TEST(StringUtilsTest, Split) {
    auto result = scratchrobin::utils::split("a,b,c", ',');
    ASSERT_EQ(result.size(), 3);
    EXPECT_EQ(result[0], "a");
    EXPECT_EQ(result[1], "b");
    EXPECT_EQ(result[2], "c");
}

TEST(StringUtilsTest, Join) {
    std::vector<std::string> parts = {"a", "b", "c"};
    EXPECT_EQ(scratchrobin::utils::join(parts, ","), "a,b,c");
    EXPECT_EQ(scratchrobin::utils::join(parts, " "), "a b c");
}
```

#### 4.2 Integration Testing Structure

```cpp
// tests/integration/test_connection_manager.cpp
#include "core/connection_manager.h"
#include <gtest/gtest.h>
#include <memory>

class ConnectionManagerTest : public ::testing::Test {
protected:
    void SetUp() override {
        // Set up test database
        db_ = scratchbird::create_database(":memory:");
        conn_manager_ = std::make_unique<scratchrobin::ConnectionManager>(db_.get());
    }

    void TearDown() override {
        conn_manager_.reset();
        db_.reset();
    }

    std::unique_ptr<scratchbird::Database> db_;
    std::unique_ptr<scratchrobin::ConnectionManager> conn_manager_;
};

TEST_F(ConnectionManagerTest, ConnectDisconnect) {
    std::string conn_id = "test_conn";
    EXPECT_TRUE(conn_manager_->connect("test_connection_string"));
    EXPECT_TRUE(conn_manager_->isConnected(conn_id));
    conn_manager_->disconnect(conn_id);
    EXPECT_FALSE(conn_manager_->isConnected(conn_id));
}

TEST_F(ConnectionManagerTest, ConnectionPool) {
    EXPECT_EQ(conn_manager_->getPoolSize(), 0);
    conn_manager_->setMaxPoolSize(10);
    // Test connection pool functionality
}
```

### Step 5: Configuration Management

#### 5.1 Configuration Structure

```cpp
// src/config/config.h
#ifndef SCRATCHROBIN_CONFIG_H
#define SCRATCHROBIN_CONFIG_H

#include <string>
#include <unordered_map>
#include <variant>

namespace scratchrobin {

using ConfigValue = std::variant<std::string, int, double, bool>;

class Config {
public:
    static Config& getInstance();

    // Configuration loading
    bool loadFromFile(const std::string& filename);
    bool saveToFile(const std::string& filename);

    // Value access
    template<typename T>
    T get(const std::string& key, const T& default_value = T{}) const;

    template<typename T>
    void set(const std::string& key, const T& value);

    // Configuration sections
    std::unordered_map<std::string, ConfigValue> getSection(const std::string& section) const;

private:
    Config() = default;
    std::unordered_map<std::string, ConfigValue> config_;
};

} // namespace scratchrobin

#endif // SCRATCHROBIN_CONFIG_H
```

#### 5.2 Default Configuration

```ini
# Default configuration file
[database]
connection_pool_size = 10
connection_timeout = 30
query_timeout = 300

[ui]
theme = light
font_size = 12
max_connections_display = 50

[logging]
level = info
max_file_size = 10485760
max_files = 5
log_directory = logs/

[security]
enable_ssl = true
ssl_cert_file = certs/server.crt
ssl_key_file = certs/server.key
session_timeout = 3600
```

### Step 6: Development Environment Setup

#### 6.1 Docker Development Environment

```dockerfile
# Dockerfile.dev
FROM node:18-alpine

# Install dependencies
RUN apk add --no-cache \
    git \
    cmake \
    build-base \
    python3 \
    go \
    openjdk11

# Set working directory
WORKDIR /app

# Copy package files
COPY package*.json ./
RUN npm install

# Copy source code
COPY . .

# Expose ports
EXPOSE 3000 8080

# Start development server
CMD ["npm", "run", "dev"]
```

#### 6.2 VS Code Configuration

```json
// .vscode/settings.json
{
    "editor.formatOnSave": true,
    "editor.codeActionsOnSave": {
        "source.fixAll.eslint": true
    },
    "files.associations": {
        "*.cpp": "cpp",
        "*.h": "cpp"
    },
    "C_Cpp.default.compilerPath": "/usr/bin/g++",
    "C_Cpp.default.cppStandard": "c++17",
    "typescript.preferences.preferTypeOnlyAutoImports": true,
    "typescript.suggest.autoImports": true
}

// .vscode/launch.json
{
    "version": "0.2.0",
    "configurations": [
        {
            "name": "Debug ScratchRobin",
            "type": "cppdbg",
            "request": "launch",
            "program": "${workspaceFolder}/build/bin/scratchrobin",
            "args": [],
            "stopAtEntry": false,
            "cwd": "${workspaceFolder}",
            "environment": [],
            "externalConsole": false,
            "MIMode": "gdb",
            "setupCommands": [
                {
                    "description": "Enable pretty-printing for gdb",
                    "text": "-enable-pretty-printing",
                    "ignoreFailures": true
                }
            ]
        }
    ]
}
```

### Step 7: Build and Test Automation

#### 7.1 GitHub Actions Workflow

```yaml
# .github/workflows/build.yml
name: Build and Test

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [18.x, 20.x]

    steps:
    - uses: actions/checkout@v3

    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: ${{ matrix.node-version }}
        cache: 'npm'

    - name: Install dependencies
      run: npm ci

    - name: Run linting
      run: npm run lint

    - name: Build application
      run: npm run build

    - name: Run unit tests
      run: npm run test:unit

    - name: Run integration tests
      run: npm run test:integration

    - name: Build C++ components
      run: |
        mkdir build
        cd build
        cmake ..
        make -j$(nproc)

    - name: Run C++ tests
      run: cd build && make test
```

#### 7.2 Pre-commit Hooks

```bash
#!/bin/bash
# .git/hooks/pre-commit

# Run linting
npm run lint
if [ $? -ne 0 ]; then
    echo "Linting failed. Please fix the issues before committing."
    exit 1
fi

# Run unit tests
npm run test:unit
if [ $? -ne 0 ]; then
    echo "Unit tests failed. Please fix the issues before committing."
    exit 1
fi

# Format code
npm run format

echo "Pre-commit checks passed!"
```

## Verification Steps

### Step 8: Project Validation

#### 8.1 Build Verification
```bash
# Build web interface
cd web
npm install
npm run build

# Build C++ components
mkdir ../build
cd ../build
cmake ..
make -j$(nproc)

# Run tests
make test
```

#### 8.2 Directory Structure Verification
```bash
# Check that all required directories exist
required_dirs=(
    "src/core"
    "src/components"
    "src/utils"
    "web/src"
    "web/public"
    "tests/unit"
    "tests/integration"
    "ProjectPlan/Implementation"
)

for dir in "${required_dirs[@]}"; do
    if [ ! -d "$dir" ]; then
        echo "Missing directory: $dir"
        exit 1
    fi
done
```

#### 8.3 Configuration Verification
```bash
# Check that configuration files exist and are valid
config_files=(
    "package.json"
    "CMakeLists.txt"
    "src/main.cpp"
    ".gitignore"
    "README.md"
)

for file in "${config_files[@]}"; do
    if [ ! -f "$file" ]; then
        echo "Missing file: $file"
        exit 1
    fi
done
```

## Success Criteria

- ✅ **Project structure created** with all required directories
- ✅ **Build system configured** for all components
- ✅ **Dependencies resolved** and documented
- ✅ **Development environment** set up and tested
- ✅ **Basic application skeleton** compiles and runs
- ✅ **Testing framework** established and functional
- ✅ **CI/CD pipeline** configured and operational
- ✅ **Documentation** structure created and populated

## Dependencies

### External Dependencies
- **ScratchBird Engine**: Core database functionality
- **Node.js/npm**: Web interface development
- **CMake**: C++ build system
- **Go**: CLI tools development
- **Python**: Build scripts and client library
- **Java**: Client library and testing
- **Material-UI**: Web interface components
- **Google Test**: C++ testing framework

### Development Tools
- **Git**: Version control
- **Visual Studio Code**: Primary IDE
- **Docker**: Development environment
- **GitHub Actions**: CI/CD pipeline
- **ESLint/Prettier**: Code quality tools

## Troubleshooting

### Common Issues and Solutions

#### Issue 1: Build Failures
**Problem**: Compilation errors in C++ code
**Solution**:
```bash
# Clean build directory
rm -rf build/
mkdir build && cd build

# Reconfigure with debug info
cmake -DCMAKE_BUILD_TYPE=Debug ..
make -j$(nproc) VERBOSE=1
```

#### Issue 2: Node.js Dependencies
**Problem**: npm install failures
**Solution**:
```bash
# Clear npm cache
npm cache clean --force

# Reinstall dependencies
rm -rf node_modules package-lock.json
npm install
```

#### Issue 3: Test Failures
**Problem**: Unit tests not passing
**Solution**:
```bash
# Run specific test with debug output
npm run test -- --testNamePattern="testName" --verbose

# Check test environment
echo $NODE_ENV
echo $DATABASE_URL
```

## Next Steps

After completing this setup:

1. **Proceed to Phase 1.2**: Architecture design and component planning
2. **Implement core components**: Connection manager, metadata loader
3. **Set up testing infrastructure**: Unit tests, integration tests
4. **Create development workflows**: CI/CD, code review processes

This implementation provides a solid foundation for the entire ScratchRobin project, ensuring consistent development practices and maintainable code structure.
