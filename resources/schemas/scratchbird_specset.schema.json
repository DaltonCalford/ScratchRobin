{
  "$schema": "beta1b://schema/json/draft-2020-12",
  "$id": "beta1b://schema/scratchbird_specset.schema.json",
  "title": "ScratchBird SpecSet Model",
  "type": "object",
  "required": [
    "spec_sets",
    "spec_files",
    "coverage_links",
    "conformance_bindings"
  ],
  "additionalProperties": false,
  "properties": {
    "spec_sets": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/SpecSet"
      }
    },
    "spec_files": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/SpecFile"
      }
    },
    "coverage_links": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/SpecCoverageLink"
      }
    },
    "conformance_bindings": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/SpecConformanceBinding"
      }
    }
  },
  "$defs": {
    "timestamp": {
      "type": "string",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"
    },
    "set_id": {
      "type": "string",
      "enum": [
        "sb_v3",
        "sb_vnext",
        "sb_beta1"
      ]
    },
    "path": {
      "type": "string",
      "minLength": 1,
      "pattern": "^(?!.*\\.\\.).*$"
    },
    "hex_sha256": {
      "type": "string",
      "pattern": "^[0-9a-f]{64}$"
    },
    "SpecSet": {
      "type": "object",
      "required": [
        "set_id",
        "package_manifest_ref",
        "package_root",
        "authoritative_inventory_relpath",
        "version_stamp",
        "package_hash_sha256",
        "last_indexed_at",
        "index_status",
        "index_error"
      ],
      "additionalProperties": false,
      "properties": {
        "set_id": {
          "$ref": "#/$defs/set_id"
        },
        "package_manifest_ref": {
          "$ref": "#/$defs/path"
        },
        "package_root": {
          "$ref": "#/$defs/path"
        },
        "authoritative_inventory_relpath": {
          "$ref": "#/$defs/path"
        },
        "version_stamp": {
          "type": "string",
          "minLength": 1
        },
        "package_hash_sha256": {
          "$ref": "#/$defs/hex_sha256"
        },
        "last_indexed_at": {
          "type": [
            "string",
            "null"
          ],
          "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"
        },
        "index_status": {
          "type": "string",
          "enum": [
            "unindexed",
            "indexed",
            "stale",
            "error"
          ]
        },
        "index_error": {
          "type": [
            "string",
            "null"
          ]
        }
      }
    },
    "SpecFile": {
      "type": "object",
      "required": [
        "set_id",
        "section_id",
        "relative_path",
        "is_normative",
        "file_role",
        "content_hash",
        "last_seen_at",
        "size_bytes"
      ],
      "additionalProperties": false,
      "properties": {
        "set_id": {
          "$ref": "#/$defs/set_id"
        },
        "section_id": {
          "type": "string",
          "minLength": 1
        },
        "relative_path": {
          "$ref": "#/$defs/path"
        },
        "is_normative": {
          "type": "boolean"
        },
        "file_role": {
          "type": "string",
          "enum": [
            "readme",
            "spec_outline",
            "decision",
            "dependencies",
            "test_contract",
            "contract",
            "matrix",
            "registry",
            "vector",
            "other"
          ]
        },
        "content_hash": {
          "$ref": "#/$defs/hex_sha256"
        },
        "last_seen_at": {
          "$ref": "#/$defs/timestamp"
        },
        "size_bytes": {
          "type": "integer",
          "minimum": 0
        }
      }
    },
    "SpecCoverageLink": {
      "type": "object",
      "required": [
        "spec_file_ref",
        "robin_surface_or_service_id",
        "coverage_class",
        "coverage_state",
        "conformance_case_id",
        "last_updated_at"
      ],
      "additionalProperties": false,
      "properties": {
        "spec_file_ref": {
          "type": "string",
          "pattern": "^(sb_v3|sb_vnext|sb_beta1):.+$"
        },
        "robin_surface_or_service_id": {
          "type": "string",
          "minLength": 1
        },
        "coverage_class": {
          "type": "string",
          "enum": [
            "design",
            "development",
            "management"
          ]
        },
        "coverage_state": {
          "type": "string",
          "enum": [
            "covered",
            "partial",
            "missing"
          ]
        },
        "conformance_case_id": {
          "type": [
            "string",
            "null"
          ]
        },
        "last_updated_at": {
          "$ref": "#/$defs/timestamp"
        }
      }
    },
    "SpecConformanceBinding": {
      "type": "object",
      "required": [
        "binding_id",
        "spec_file_ref",
        "case_id",
        "binding_kind",
        "notes"
      ],
      "additionalProperties": false,
      "properties": {
        "binding_id": {
          "type": "string",
          "minLength": 1
        },
        "spec_file_ref": {
          "type": "string",
          "pattern": "^(sb_v3|sb_vnext|sb_beta1):.+$"
        },
        "case_id": {
          "type": "string",
          "minLength": 1
        },
        "binding_kind": {
          "type": "string",
          "enum": [
            "required",
            "supporting"
          ]
        },
        "notes": {
          "type": [
            "string",
            "null"
          ]
        }
      }
    }
  }
}
