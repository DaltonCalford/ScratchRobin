# SBSEC-06.01 Quorum Proposal Canonicalization and Hashing


## 1. Purpose

Defines a canonical encoding for quorum-controlled operations so that all nodes and independent implementations
compute identical proposal hashes and signatures.

This is required to prevent “what exactly did I vote for?” ambiguity.

## 2. Quorum Proposal Envelope

A quorum proposal MUST contain:

- `proposal_id` (UUIDv7)
- `cluster_id` (UUIDv7)
- `op_type` (enum)
- `target_ids` (ordered list of UUIDv7)
- `parameters` (typed map; see §3)
- `requested_by` (principal UUID)
- `created_at` (unix seconds)
- `expires_at` (unix seconds; REQUIRED)
- `policy_epoch` (optional but recommended)

## 3. Canonical Encoding (TLV)

Proposals MUST be encoded as TLV with the following rules:

- Fields are encoded in ascending tag order.
- Integers are unsigned big-endian with minimal bytes.
- UUIDv7 is 16 raw bytes.
- Strings are UTF-8, NFC normalized.
- Maps are encoded as a sequence of (key, value) TLVs sorted by key bytes.
- No floats allowed.

### 3.1 Tags (V1)

- 0x01 proposal_id (UUID)
- 0x02 cluster_id (UUID)
- 0x03 op_type (u16)
- 0x04 target_ids (repeated UUID TLVs)
- 0x05 requested_by (UUID)
- 0x06 created_at (u64)
- 0x07 expires_at (u64)
- 0x08 parameters (nested TLV)
- 0x09 policy_epoch (u64) optional
- 0x0A version (u16) = 1

## 4. Proposal Hash

`proposal_hash = SHA-256(TLV_bytes)`

All approvals MUST sign `proposal_hash`, not a textual rendering.

## 5. Signatures and Evidence

Each approval record MUST include:
- approver principal UUID
- decision (APPROVE/DENY)
- signature over `proposal_hash`
- approval timestamp

Evidence records are defined in SBSEC-06.02.

